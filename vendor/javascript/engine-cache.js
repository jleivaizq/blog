// engine-cache@0.19.4 downloaded from https://ga.jspm.io/npm:engine-cache@0.19.4/index.js

import e from"lazy-cache";import n from"async-helpers";import r from"extend-shallow";import t from"helper-cache";import i from"isobject";import o from"mixin-deep";var s={};var p=e(null);var c=null;require=p;n;r;t;i;o;require=c;p.isString=function(e){return e&&"string"===typeof e};p.arrayify=function(e){return e?Array.isArray(e)?e:[e]:[]};p.formatExt=function(e){return p.isString(e)?"."!==e.charAt(0)?"."+e:e:""};p.stripExt=function(e){if(!p.isString(e))return"";"."===e.charAt(0)&&(e=e.slice(1));return e};p.isEngine=function(e){return"function"===typeof e||!!p.isObject(e)&&(e.hasOwnProperty("render")||e.hasOwnProperty("renderSync")||e.hasOwnProperty("renderFile"))};s=p;var f=s;var a={};var u=f;a=Engines;function Engines(e,n){this.options=n||{};this.cache=e||{};this.AsyncHelpers=this.options.AsyncHelpers||u.AsyncHelpers;this.Helpers=this.options.Helpers||u.Helpers}Engines.prototype.setEngine=function(e,n,r){var t=normalizeEngine(n,r);var i=t.options;t.helpers=new this.Helpers(i);t.asyncHelpers=new this.AsyncHelpers(i);t.name=u.stripExt(t.name||i.name||e);i.ext=u.formatExt(e);decorate(t);inspect(t);this.cache[i.ext]=t;return this};Engines.prototype.setEngines=function(e){for(var n in e)e.hasOwnProperty(n)&&"clearCache"!==n&&this.setEngine(n,e[n]);return this};Engines.prototype.getEngine=function(e){var n=e?this.cache[u.formatExt(e)]:null;if(!n){n=this.options.defaultEngine;"string"===typeof n&&(n=this.cache[u.formatExt(n)])}return n};Engines.prototype.helpers=function(e){var n=this.getEngine(e);if(n)return n.helpers};function normalizeEngine(e,n){if(u.isEngine(n))return normalizeEngine(n,e);if(!u.isObject(e)&&"function"!==typeof e)throw new TypeError("expected an object or function");var r={};r.render=e.render||e;r.options=u.extend({},n);if("function"!==typeof r.render)throw new Error("expected engine to have a render method");for(var t in e)if("options"!==t){"__express"!==t||e.hasOwnProperty("renderFile")||(r.renderFile=e[t]);r[t]=e[t]}else r.options=u.merge({},r.options,e[t]);return r}function decorate(e){var n=e.renderSync;var r=e.render;var t=e.compile;e.compile=function engineCompile(i,o){if("function"===typeof i)return i;if("undefined"!==typeof o&&!u.isObject(o))throw new TypeError("expected options to be an object or undefined");o=u.extend({},o);var s=mergeHelpers(e,o);var p=t?t.call(e,i,s):null;return function(t,c){if("function"===typeof t){c=t;t={}}if("function"===typeof p){i=p;s={}}var f={};f="string"===typeof t||Array.isArray(t)?t:o&&"function"===typeof o.mergeFn?o.mergeFn(s,t):u.merge({},t,s);if("function"!==typeof c)return n.call(e,i,f);r.call(e,i,f,(function(n,r){n?c(n):e.asyncHelpers.resolveIds(r,c)}))}};e.render=function engineRender(e,n,r){if("function"===typeof n){r=n;n={}}if("function"!==typeof r)throw new TypeError("expected a callback function");if("function"!==typeof e)if("string"===typeof e){var t=n.async;n.async=true;var i=this.compile(e,n);i(n,(function(e,i){if(e)r(e);else{n.async=t;r(null,i)}}))}else r(new TypeError("expected a string or compiled function"));else e(n,r)};e.renderSync=function wrappedRenderSync(e,n){if("function"===typeof e)return e(n);if("string"!==typeof e)throw new TypeError("expected a string or compiled function");var r=u.extend({},n);r.helpers=u.merge({},this.helpers,r.helpers);var t=this.compile(e,r);return t(r)}}function inspect(e){var n=['"'+e.name+'"'];var r=u.arrayify(e.options.ext).join(", ");n.push('<ext "'+r+'">');e.inspect=function(){return"<Engine "+n.join(" ")+">"}}function mergeHelpers(e,n){if(!n||"object"!==typeof n)throw new TypeError("expected an object");var r=u.extend({},n);var t=u.merge({},e.helpers,r.helpers);for(var i in t)t.hasOwnProperty(i)&&e.asyncHelpers.set(i,t[i]);r.helpers=e.asyncHelpers.get({wrap:r.async});return r}var l=a;export default l;

