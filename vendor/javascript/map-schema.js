// map-schema@0.2.4 downloaded from https://ga.jspm.io/npm:map-schema@0.2.4/index.js

import t from"util";import e from"component-emitter";import i from"debug";import r from"lazy-cache";import n from"arr-union";import o from"collection-visit";import s from"define-property";import a from"extend-shallow";import p from"get-value";import f from"is-primitive";import l from"kind-of";import u from"log-utils";import h from"longest";import d from"mixin-deep";import c from"object.omit";import m from"object.pick";import y from"omit-empty";import v from"pad-right";import g from"set-value";import w from"sort-object-arrays";import O from"union-value";var b={},S=false;function dew(){if(S)return b;S=true;var e=t;var i=dew$1();b={missing:function(t){return'Required field "'+t.prop+'" is missing'},deprecated:function(t){var e=t.message;return'property "'+e.actual+'" is deprecated, use "'+e.expected+'" instead'},invalidField:function(t){return'invalid property: "'+t.prop+'". Since `options.knownOnly` is true, only properties with fields defined on the schema may be used.'},invalidFile:function(t){return'file "'+t.message.actual+'" does not exist on the file system'},invalidType:function(t){var e=t.message;return'expected "'+t.prop+'" to be '+i.article(e.expected)+' but got "'+e.actual+'"'},invalidValue:function(t){var i=t.message.actual;return'invalid value defined on property "'+t.prop+'": '+e.inspect(i)}};return b}var j={},x=false;function dew$1(){if(x)return j;x=true;var t=j=r(null);var e=dew();var i=null;require=t;n;o;s;a;p;f;l;u;h;d;c;m;y;v;g;w;O;require=i;t.symbol=t.log.symbols;t.color=t.log.colors;t.hasValue=function(t,e){if(!e.hasOwnProperty(t))return false;var i=e[t];return"undefined"!==typeof i&&"undefined"!==i&&(null!==i&&""!==i)};t.hasElement=function(t,e){"string"===typeof e&&(e=[e]);return-1===e.indexOf(t)};t.isEmpty=function(e){return t.isPrimitive(e)?0===e||null===e||"undefined"===typeof e:Array.isArray(e)?0===e.length:t.isObject(e)?0===Object.keys(t.omitEmpty(e)).length:void 0};t.isObject=function(e){return"object"===t.typeOf(e)};t.arrayify=function(t){return t?Array.isArray(t)?t:[t]:[]};t.article=function(e){if("string"===typeof e||1===e.length){var i=/^[aeiou]/.test(String(e))?"an ":"a ";return i+e}return e.map((function(e){return t.article(e)})).join(" or ")};t.formatWarning=function(i){var r=i.method;var n=t.log.warning;n+=" ";n+=t.color.yellow("warning");n+=" ";n+="custom"===r?i.message:e[i.method](i);return n};return j}var F={},q=false;function dew$2(){if(q)return F;q=true;var t=dew$1();var e=F=function Data(){};e.prototype.set=function(){t.set.bind(this,this).apply(this,arguments);return this};e.prototype.get=function(){return t.get.bind(this,this).apply(this,arguments)};e.prototype.merge=function(){t.merge.bind(this,this).apply(this,arguments);return this};return F}var z={},k=false;function dew$3(){if(k)return z;k=true;var t=dew$1();z=Field;function Field(e,i){if("object"===t.typeOf(e)){i=e;e=null}if(!t.isObject(i))throw new TypeError("expected config to be an object");this.types=e||i.type||i.types||[];this.types="string"===typeof this.types?this.types.split(/\W/):this.types;if("undefined"===typeof this.types||0===this.types.length)throw new TypeError("expected type to be a string or array of JavaScript native types");for(var r in i)this[r]=i[r];i.hasOwnProperty("required")||(this.required=false);i.hasOwnProperty("optional")||(this.optional=true);true===this.required&&(this.optional=false);false===this.optional&&(this.required=true)}Field.prototype.isValidType=function(e){return-1!==this.types.indexOf(t.typeOf(e))};Field.prototype.validate=function(){return true};Field.prototype.normalize=function(t,e,i){i[e]=t;return t};return z}var T={},V=false;function dew$4(){if(V)return T;V=true;var r=t;var n=e;var o=i("map-schema");var s=dew$2();var a=dew$3();var p=dew$1();T=Schema;function Schema(t){this.options=t||{};this.data=new s;this.isSchema=true;this.utils=p;this.initSchema();this.addFields(this.options);var e=p.arrayify(this.options.pick||this.options.only);p.define(this.options,"only",e)}n(Schema.prototype);Schema.prototype.initSchema=function(){this.normalizers={};this.validators={};this.defaults={};this.required=[];this.warnings=[];this.fields={};this.remove=[];this.fns=[]};Schema.prototype.set=function(t,e){p.set(this,t,e);return this};Schema.prototype.warning=function(t,e,i,r){var n={method:t,prop:e,message:i,args:r};"undefined"!==typeof r&&(n.value=r);this.warnings.push(n);this.emit("warning",t,e,n);return this};Schema.prototype.field=function(t,e,i){var r=p.arrayify(this.options.pick||this.options.only);if(r&&r.length&&!p.hasElement(t,r))return this;"function"===typeof i&&(i={normalize:i});o('adding field "%s"',t);var n=new a(e,i||{});n.name=t;n.hasOwnProperty("default")&&(this.defaults[t]=n.default);n.required&&this.required.push(t);this.fields[t]=n;return this};Schema.prototype.addFields=function(t){t=t||{};if(t.fields)for(var e in t.fields){var i=t.fields[e];this.fields[e]&&(i.extend||t.extend)&&(i=p.merge({},i,this.fields[e]));this.field(e,i)}return this};Schema.prototype.get=function(t,e){return p.get(this.fields,e?[t,e]:t)};Schema.prototype.omit=function(t){this.remove.push(t);return this};Schema.prototype.removeKey=function(t,e){if(-1!==this.remove.indexOf(t)){delete this.defaults[t];delete e[t];return true}};Schema.prototype.update=function(t,e,i){o('updating field "%s"',t);if(2===arguments.length){i=e;e=i[t]}"undefined"!==typeof e&&i&&(i[t]=e);this.normalizeField(t,e,i);return this};Schema.prototype.isOptional=function(t){return true===this.get(t,"optional")};Schema.prototype.isRequired=function(t){return true===this.get(t,"required")};Schema.prototype.setDefaults=function(t){t=p.extend({},t);if(false===this.options.defaults)return t;for(var e in this.defaults)p.hasValue(e,t)||(t[e]=this.defaults[e]);return t};Schema.prototype.missingFields=function(t){if(false===this.options.required)return false;var e=this.required.length,i=-1;var r=[];while(++i<e){var n=this.required[i];if(!t.hasOwnProperty(n)){this.warning("missing",n);r.push(n)}}return r};Schema.prototype.sortObject=function(t,e){var i=p.merge({},this.options,e);var r=i.keys;if(Array.isArray(r)&&r.length){r=p.union(r,Object.keys(t));var n=r.length,o=-1;var s={};while(++o<n){var a=r[o];t.hasOwnProperty(a)&&(s[a]=t[a])}return s}return t};Schema.prototype.sortArrays=function(t){return false!==this.options.sortArrays?p.sortArrays(t):t};Schema.prototype.isValidField=function(t){var e=this.get(t);return"undefined"===typeof e?true!==this.options.knownOnly:e.isValidType(this.config[t],t,this.config,this)};Schema.prototype.isValidType=function(t,e,i){i=i||{};this.config=i;var r=this.get(t);if("undefined"===typeof r){if(this.options.knownOnly){this.warning("invalidField",t);return false}return true}if(r.isValidType(e,t,i,this))return true;if((i.hasOwnProperty(t)||"function"===typeof r.normalize)&&(this.isRequired(t)||"undefined"!==typeof e)){var n=this.get(t,"types");var o={expected:n,actual:e};this.warning("invalidType",t,o)}return false};Schema.prototype.validate=function(t){if(!p.isObject(t))throw new TypeError("expected config to be an object");for(var e in t)this.validateField(t[e],e,t);return this.warnings};Schema.prototype.validateField=function(t,e,i){var r=this.fields[e];p.isObject(r)||true!==this.options.knownOnly||this.warning("invalidField",e);this.isValidType(e,t,i);if("function"===typeof r.validate){var n=r.validate(t,e,i,this);n||this.warning("invalidValue",e,{actual:t});return n}};Schema.prototype.normalize=function(t,e){o("normalizing config");if("object"!==p.typeOf(t))throw new TypeError("expected config to be an object");e=e||{};this.addFields(e);this.config=t;t=this.setDefaults(t);var i=p.merge({},this.options,e);var r=p.arrayify(i.only||i.pick);r.length&&(this.fields=p.pick(this.fields,r));for(var n in this.fields)(true!==i.existingOnly||t.hasOwnProperty(n))&&this.fields.hasOwnProperty(n)&&this.normalizeField.call(this,n,t[n],t,i);this.missingFields(t);var s=p.arrayify(i.omit);true===i.omitEmpty&&(t=p.omitEmpty(t));r.length&&(t=p.pick(t,r));var a=p.union([],this.remove,s);t=p.omit(t,a);t=this.sortObject(t,i);t=this.sortArrays(t);this.logWarnings(t);p.define(t,"isNormalized",true);this.emit("normalized",t);return t};Schema.prototype.normalizeField=function(t,e,i,n){o('normalizing field "%s", "%j"',t,r.inspect(e));if(this.fields.hasOwnProperty(t)){var s=this.fields[t];var a=i[t];if(p.isObject(s)){s.isNormalized=true;var f=s.normalize;if("function"===typeof f&&!this.options.validate){s.isSchema&&s.warnings.length&&p.union(this.warnings,s.warnings);a=f.call(this,a,t,i,this);s.isValidType(a)&&(i[t]=a);if(this.removeKey(t,i))return}if(false===this.isValidType(t,a,i))return;if("function"===typeof s.validate&&!this.options.normalize&&!this.validateField(a,t,i))return}else this.isValidType(t,a,i);this.removeKey(t,i)}else this.removeKey(t,i)};Schema.prototype.visit=function(t,e){p.visit(this,t,e);return this};Schema.prototype.logWarnings=function(t){t=t||this.warnings;var e=p.arrayify(this.options.omit);var i=t.length;var r=-1;if(true===this.options.verbose&&0!==i){var n=p.longest(Object.keys(this.fields)).length;var o="\n";while(++r<i){r>0&&(o+="\n");var s=t[r];-1===e.indexOf(s.prop)&&(o+=p.formatWarning(s,n))}console.log(o)}};return T}var $=dew$4();export default $;export{dew$4 as __dew};

