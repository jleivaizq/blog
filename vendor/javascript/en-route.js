// en-route@0.7.5 downloaded from https://ga.jspm.io/npm:en-route@0.7.5/index.js

import r from"debug";import t from"lazy-cache";import e from"kind-of";import a from"arr-flatten";import n from"extend-shallow";import o from"path-to-regexp";var i={};var s=t(null);var h=null;require=s;e;a;n;o;require=h;s.arrayify=function arrayify(r){return r?Array.isArray(r)?r:[r]:[]};s.decodeParam=function decodeParam(r){if("string"!==typeof r)return r;try{return decodeURIComponent(r)}catch(e){var t=new TypeError("Failed to decode param '"+r+"'");t.status=400;throw t}};i=s;var u=i;var p={};var f=r("router:layer");var l=u;var c=p=function Layer(r,t,e){if(!(this instanceof Layer))return new Layer(r,t,e);f("new %s",r);t=t||{};this.handle=e;this.name=e.name||"<unknown>";this.regexp=l.toRegex(r,this.keys=[],t);this.params=void 0;this.path=void 0;"/"===r&&false===t.end&&(this.regexp.fast_slash=true)};c.prototype.handleError=function handleError(r,t,e){var a=this.handle;if(3!==a.length)return e(r);try{a(r,t,e)}catch(r){e(r)}};c.prototype.handleFile=function handleFile(r,t){var e=this.handle;if(e.length>2)return t();try{e(r,t)}catch(r){t(r)}};c.prototype.match=function match(r){if(null==r){this.params=void 0;this.path=void 0;return false}if(this.regexp.fast_slash){this.params={};this.path="";return true}var t=this.regexp.exec(r);if(!t){this.params=void 0;this.path=void 0;return false}this.params={};this.path=t[0];var e=this.keys;var a=this.params;var n;var o=0;var i;var s;for(var h=1,u=t.length;h<u;++h){i=e[h-1];n=i?i.name:o++;s=l.decodeParam(t[h]);void 0===s&&{}.hasOwnProperty.call(a,n)||(a[n]=s)}return true};var v=p;var m={};var d=r("router:route");var y=v;var g=m=function Route(r,t){d("new %s",r);this.path=r;this.stack=[];this.methods={};decorate(this,t||[])};g.prototype.handlesMethod=function handlesMethod(r){if(this.methods._all)return true;r=r&&r.toLowerCase();return!!this.methods[r]};g.prototype.dispatch=function dispatch(r,t){var e=0;var a=this.stack;if(0===a.length)return t();r.options=r.options||{};var n=r.options.method&&r.options.method.toLowerCase();r.options.route=this;next();function next(o){if(o&&"route"===o)return t();var i=a[e++];if(!i)return t(o);if(i.method&&i.method!==n)return next(o);o?i.handleError(o,r,next):i.handleFile(r,next)}};g.prototype.all=function all(){var r=arguments.length,t=0;while(r--){var e=arguments[t];Array.isArray(e)&&(e=e[0]);if("function"!==typeof e){var a={}.toString.call(e);var n="Route.all() requires callback functions but got a "+a;throw new Error(n)}var o=y("/",{},e);o.method=void 0;this.methods._all=true;this.stack.push(o)}return this};function decorate(r,t){t.forEach((function(t){Object.defineProperty(r,t,{enumerable:false,configurable:true,value:function(){var r=arguments.length,e=0;while(r--){var a=arguments[e++];if("function"!==typeof a){var n={}.toString.call(a);var o="route."+t+"() requires callback functions but got a "+n;throw new Error(o)}t=t&&t.toLowerCase();d("%s %s",t,this.path);var i=new y("/",{},a);i.method=t;this.methods[t]=true;this.stack.push(i)}return this}})}))}var w=m;var x={};var b=r("router");var P=u;var k=w;var E=v;var _=x=function proto(r){r=r||{};function router(r,t){router.handle(r,t)}router.__proto__=proto;router.params={};router._params=[];router.caseSensitive=r.caseSensitive;router.mergeParams=r.mergeParams;router.strict=r.strict;router.stack=[];router.methods=P.arrayify(r.methods);decorate$1(router,router.methods);return router};_.param=function(r,t){if("function"!==typeof r){var e=this._params;var a=e.length;var n;":"===r[0]&&(r=r.substr(1));for(var o=0;o<a;++o)(n=e[o](r,t))&&(t=n);if("function"!==typeof t)throw new Error("invalid param() call for "+r+", got "+t);(this.params[r]=this.params[r]||[]).push(t);return this}this._params.push(r)};_.handle=function(r,t){var e=this;r.options=r.options||{};b("dispatching %s",r.path);var a=0;var n="";var o=false;var i={};var s=e.stack;var h=r.options.params;var u=r.options.basePath||"";t=restore(t,r.options,"basePath","next","params");_.defineOption(r,"next",next);_.defineOption(r,"basePath",u);_.defineOption(r,"originalPath",r.options.originalPath||r.path);next();function next(p){var f="route"===p?null:p;var l=s[a++];if(o){r.path=r.path.substr(1);o=false}if(0!==n.length){r.options.basePath=u;r.path=n+r.path;n=""}if(!l)return t(f);e.matchLayer(l,r,(function(t,a){if(t||void 0===a)return next(f||t);var n=l.route;if(n){if(f)return next(f);var o=r.options.method;var s=n.handlesMethod(o);if(!s)return next();r.options.route=n}r.options.params=e.mergeParams?mergeParams(l.params,h):l.params;var u=l.path;e.processParams(l,i,r,(function(t){if(t)return next(f||t);if(n)return l.handleFile(r,next);trimPrefix(l,f,u,a)}))}))}function trimPrefix(t,e,a,i){if(0!==a.length){b("trim prefix (%s) from path %s",a,r.path);n=a;r.path=r.path.substr(n.length);if("/"!==r.path[0]){r.path="/"+r.path;o=true}var s=n.length;var h="/"===n[s-1]?n.substring(0,s-1):n;r.options.basePath=u+h}b("%s %s : %s",t.name,a,r.options.originalPath);e?t.handleError(e,r,next):t.handleFile(r,next)}};_.matchLayer=function matchLayer(r,t,e){var a=null;var n;try{n=t.path;r.match(n)||(n=void 0)}catch(r){a=r}e(a,n)};_.processParams=function(r,t,e,a){var n=this.params;var o=r.keys;if(!o||0===o.length)return a();var i=0;var s;var h=0;var u;var p;var f;var l;function param(r){if(r)return a(r);if(i>=o.length)return a();h=0;u=o[i++];if(!u)return a();s=u.name;p=e.options.params[s];f=n[s];l=t[s];if(void 0===p||!f)return param();if(l&&(l.error||l.match===p)){e.options.params[s]=l.value;return param(l.error)}t[s]=l={error:null,match:p,value:p};paramCallback()}function paramCallback(r){var t=f[h++];l.value=e.options.params[u.name];if(r){l.error=r;param(r)}else{if(!t)return param();try{t(e,paramCallback,p,u.name)}catch(r){paramCallback(r)}}}param()};_.use=function use(r){var t=0;var e="/";if("function"!==typeof r){var a=r;while(Array.isArray(a)&&0!==a.length)a=a[0];if("function"!==typeof a){t=1;e=r}}var n=P.flatten([].slice.call(arguments,t));var o=n.length,i=0;if(0===o)throw new TypeError("expected middleware functions to be defined");while(o--){var s=n[i++];if("function"!==typeof s)throw new TypeError("expected callback to be a function, but received: "+P.typeOf(s));b("use %s %s",e,s.name||"<unknown>");var h=new E(e,{sensitive:this.caseSensitive,strict:false,end:false},s);h.route=void 0;this.stack.push(h)}return this};_.route=function(r){var t=new k(r,this.methods);var e={sensitive:this.caseSensitive,strict:this.strict,end:true};var a=new E(r,e,t.dispatch.bind(t));a.route=t;this.stack.push(a);return t};_.method=function(r){r=P.arrayify(r);this.methods=this.methods.concat(r);decorate$1(this,r);return this};Object.defineProperty(_,"defineOption",{enumerable:false,value:function(r,t,e){r.options=r.options||{};Object.defineProperty(r.options,t,{enumerable:false,configurable:true,set:function(r){e=r},get:function(){return e}})}});function decorate$1(r,t){var e=t.concat("all");var a=e.length,n=0;while(a--){var o=e[n++];r[o]=function(r){var t=this.route(r);t[o].apply(t,[].slice.call(arguments,1));return this}}}function mergeParams(r,t){if("object"!==typeof t||!t)return r;var e=P.extend({},t);if(!(0 in r)||!(0 in t))return P.extend(e,r);var a=0;var n=0;while(a===n||n in t){a in r&&a++;n in t&&n++}for(a--;a>=0;a--){r[a+n]=r[a];a<n&&delete r[a]}return P.extend(t,r)}function restore(r,t){var e=arguments.length-2;var a=new Array(e);var n=new Array(e);for(var o=0;o<a.length;o++){a[o]=arguments[o+2];n[o]=t[a[o]]}return function(){for(var e=0;e<a.length;e++)t[a[e]]=n[e];return r.apply(this,arguments)}}var R=x;var L={};var O=w;var A=R;L.Route=O;L.Router=A;const C=L.Route,F=L.Router;export default L;export{C as Route,F as Router};

