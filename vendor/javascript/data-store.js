// data-store@0.16.1 downloaded from https://ga.jspm.io/npm:data-store@0.16.1/index.js

import t from"path";import r from"util";import e from"cache-base";import i from"debug";import o from"lazy-cache";import n from"clone-deep";import s from"extend-shallow";import a from"define-property";import h from"graceful-fs";import f from"has-own-deep";import c from"mkdirp";import p from"project-name";import u from"resolve-dir";import m from"rimraf";import l from"union-value";import d from"process";var y={};var v=y=o(null);var S=null;require=v;n;s;a;h;f;c;p;u;m;l;require=S;v.noop=function(){};v.last=function(t){return t[t.length-1]};v.arrayify=function(t){return t?Array.isArray(t)?t:[t]:[]};v.validateName=function(t,r){if(~t.keys.indexOf(r)&&!v.isStore(t,r))throw v.formatConflictError(r)};v.isStore=function(t,r){return!!t[r]&&"object"===typeof t[r]&&true===t[r].isStore};v.formatConflictError=function(t){var r="Cannot create store: "+'"'+t+'", since '+'"'+t+'" is a reserved property key. '+"Please choose a different store name.";return new Error(r)};var w=y;var k={};var g=d;var b=t;var O=r;var E=e;var j=E.namespace("cache");var x=i("data-store");var A=j.prototype;var F=w;k=Store;function Store(t,r){if(!(this instanceof Store))return new Store(t,r);if("string"!==typeof t){r=t;t=null}j.call(this);this.isStore=true;this.options=r||{};this.initStore(t)}O.inherits(Store,j);Store.prototype.initStore=function(t){this.name=t||F.project(g.cwd());this.cwd=F.resolve(this.options.cwd||"~/.data-store");this.path=b.resolve(this.cwd,this.name+".json");x("Initializing store <%s>",this.path);this.data=readFile(this.path);this.define("cache",F.clone(this.data));this.on("set",function(){this.save()}.bind(this))};Store.prototype.create=function(t,r){if(F.isStore(this,t))return this[t];F.validateName(this,t);var e=this;var i=b.join(b.dirname(this.path),this.name);var o=new Store(t,{cwd:i});this[t]=o;o.on("set",(function(r,i){e.set([t,r],i)}));return o};Store.prototype.union=function(t,r){F.union(this.cache,t,r);this.emit("union",t,r);this.save();return this};Store.prototype.hasOwn=function(t){var r;r=-1===t.indexOf(".")?this.cache.hasOwnProperty(t):F.hasOwn(this.cache,t);return r};Store.prototype.save=function(t){this.data=this.cache;writeJson(t||this.path,this.cache,this.options.indent);return this};Store.prototype.clear=function(){this.cache={};this.data={};return this};Store.prototype.del=function(t,r){var e=Array.isArray(t);if("string"===typeof t||e)t=F.arrayify(t);else{r=t;t=null}r=r||{};if(t){t.forEach(function(t){A.del.call(this,t)}.bind(this));this.save();return this}if(true!==r.force)throw new Error("options.force is required to delete the entire cache.");t=Object.keys(this.cache);this.clear();F.del.sync(this.path,r);t.forEach(function(t){this.emit("del",t)}.bind(this));return this};F.define(Store.prototype,"keys",{configurable:true,enumerable:true,set:function(t){F.define(this,"keys",t)},get:function fn(){if(fn.keys)return fn.keys;fn.keys=[];for(var t in this)fn.keys.push(t);return fn.keys}});Store.prototype.define=function(t,r){F.define(this,t,r);return this};function readFile(t){try{var r=F.fs.readFileSync(b.resolve(t),"utf8");return JSON.parse(r)}catch(t){}return{}}function writeJson(t,r,e){"undefined"!==typeof e&&null!==e||(e=2);var i=b.dirname(t);try{F.fs.existsSync(i)||F.mkdirp.sync(i);F.fs.writeFileSync(t,JSON.stringify(r,null,e))}catch(r){r.origin=new URL(import.meta.url).pathname;r.reason="data-store cannot write to: "+t;throw new Error(r)}}var J=k;export default J;

