// base-routes@0.2.2 downloaded from https://ga.jspm.io/npm:base-routes@0.2.2/index.js

import e from"debug";import t from"lazy-cache";import r from"en-route";import n from"is-valid-app";import i from"template-error";var o={};var s=e("base:routes");var a=t(null);var u=null;require=a;r;n;i;require=u;a.isValid=function(e){if(!a.isValidApp(e,"base-routes",["app","collection","views","list"]))return false;s("loading routes methods");return true};a.arrayify=function(e){return e?Array.isArray(e)?e:[e]:[]};a.methods=["onLoad","preCompile","preLayout","onLayout","postLayout","onMerge","onStream","postCompile","preRender","postRender","preWrite","postWrite"];o=a;var l=o;var h={};var d=e("base:routes");var f=l;h=function(e){return function baseRoutes(e){if(f.isValid(e)){this.define("Router",f.router.Router);this.define("Route",f.router.Route);this.define("lazyRouter",(function(e){"undefined"===typeof this.router&&this.define("router",new this.Router({methods:f.methods}));"undefined"!==typeof e&&this.router.method(e)}));this.define("handle",(function(t,r,n){d('handling "%s" middleware for "%s"',t,r.basename);"function"!==typeof n&&(n=function(r,n){e.handleError(t,n,(function(){throw r}))});this.lazyRouter();r.options=r.options||{};r.options.handled||(r.options.handled=[]);var i=this.handleError(t,r,n);r.options.method=t;r.options.handled.push(t);this.emit(t,r);if(this.isTemplates&&!this.isCollection&&r.options.collection){var o=this[r.options.collection];this.router.handle(r,(function(e){if(e)return i(e);o.handle(t,r,i)}))}else this.router.handle(r,i)}));this.define("handleOnce",(function(t,r,n){"function"!==typeof n&&(n=function(r,n){e.handleError(t,n,(function(){throw r}))});r.options.handled||(r.options.handled=[]);-1!==r.options.handled.indexOf(t)?n(null,r):this.handle(t,r,n)}));this.define("handleError",(function(e,t,r){var n=this;return function(i){if(i){if(true===i._handled){r();return}i._handled=true;i.source=i.stack.split("\n")[1].trim();i.reason=n._name+'#handle("'+e+'"): '+t.path;i.file=t;n.hasListeners("error")&&n.emit("error",i);if("function"!==typeof r)throw i;if(i instanceof ReferenceError)try{f.rethrow(t.content,t.data)}catch(e){console.log(e);r(e);return}r(i)}else{if("function"!==typeof r)throw new TypeError("expected a callback function");r(null,t)}}}));this.define("route",(function(){this.lazyRouter();return this.router.route.apply(this.router,arguments)}));this.define("param",(function(){this.lazyRouter();this.router.param.apply(this.router,arguments);return this}));this.define("all",(function(e){this.lazyRouter();var t=this.route(e);t.all.apply(t,[].slice.call(arguments,1));return this}));this.define("handler",(function(e){this.handlers(e);return this}));this.define("handlers",(function(e){this.lazyRouter(e);mixinHandlers(e);return this}));mixinHandlers(f.methods);return baseRoutes}function mixinHandlers(t){f.arrayify(t).forEach((function(t){e.define(t,(function(e){var r=this.route(e);var n=[].slice.call(arguments,1);r[t].apply(r,n);return this}))}))}}};var p=h;export default p;

