// async-helpers@0.3.17 downloaded from https://ga.jspm.io/npm:async-helpers@0.3.17/index.js

import e from"kind-of";import r from"co";var t={};var n=e;var s=r;var i={};var p={};function AsyncHelpers(e){if(!(this instanceof AsyncHelpers))return new AsyncHelpers(e);this.options=Object.assign({},e);this.prefix=this.options.prefix||"{$ASYNCID$";this.globalCounter=AsyncHelpers.globalCounter++;this.helpers={};this.counter=0;this.prefixRegex=toRegex(this.prefix)}AsyncHelpers.globalCounter=0;AsyncHelpers.cache=i;AsyncHelpers.stash=p;AsyncHelpers.prototype.set=function(e,r){if(isObject(e)){var t=Object.keys(e);for(var n=0;n<t.length;n++){var s=t[n];this.set(s,e[s])}return this}if("string"!==typeof e)throw new TypeError("AsyncHelpers#set: expected `name` to be a string");if("function"!==typeof r&&!isObject(r))throw new TypeError("AsyncHelpers#set: expected `fn` to be a function or object");this.helpers[e]=r;return this};AsyncHelpers.prototype.get=function(e,r){return"string"===typeof e?this.wrapHelper.apply(this,arguments):this.wrapHelpers(this.helpers,e)};AsyncHelpers.prototype.wrapHelper=function(e,r){if(isObject(e)&&"undefined"===typeof r){r=e;e=this.helpers}r=r||{};e=e||this.helpers;var t=n(e);switch(t){case"string":return this.wrapHelper(this.helpers[e],r);case"object":return this.wrapHelpers(e,r);case"function":return isHelperGroup(e)?this.wrapHelpers(e,r):r.wrap&&true!==e.wrapped?this.wrapper(e.name||e.displayName,e,this):e;default:throw new TypeError("AsyncHelpers.wrapHelper: unsupported type: "+t)}};AsyncHelpers.prototype.wrapHelpers=function(e,r){if(!isObject(e)&&isHelperGroup(e))throw new TypeError("expected helpers to be an object");var t={};var s=Object.keys(e);for(var i=0;i<s.length;i++){var p=s[i];var o=e[p];if(isObject(o))t[p]=this.wrapHelpers(o,r);else if(true!==o.wrapped){"function"!==n(o)||o.name||o.displayName||(o.displayName=p);t[p]=this.wrapHelper(o,r)}else t[p]=o}return t};AsyncHelpers.prototype.wrapper=function(e,r){var t=appendPrefix(this.prefix,this.globalCounter);var n=this;function wrapper(){var s=n.counter++;var i=createId(t,s);var o={name:e,async:!!r.async,prefix:t,num:s,id:i,fn:r,args:[].slice.call(arguments)};define(o,"context",this);p[i]=o;return i}define(wrapper,"wrapped",true);define(wrapper,"helperName",e);return wrapper};AsyncHelpers.prototype.reset=function(){p={};this.counter=0;return this};AsyncHelpers.prototype.matches=function(e){if("string"!==typeof e)throw new TypeError("AsyncHelpers#matches expects a string");return e.match(this.prefixRegex)};AsyncHelpers.prototype.hasAsyncId=function(e){if("string"!==typeof e)throw new TypeError("AsyncHelpers#hasAsyncId expects a string");return-1!==e.indexOf(this.prefix)};AsyncHelpers.prototype.resolveId=function*(e){if("string"!==typeof e)throw new Error("AsyncHelpers#resolveId: expects `key` to be a string.");var r=p[e];if(!r)throw new Error('AsyncHelpers#resolveId: cannot resolve helper: "'+e+'"');var t=yield this.resolveArgs(r);var n=this;var s;return yield function(e){if("function"===typeof r.fn){var next=function(t,n){if("undefined"===typeof n)e(t,"");else{r.fn=n;e(t,r.fn)}};if(r.fn.async){var callback=function(e,s){e?next(formatError(e,r,t)):"string"===typeof s&&n.hasAsyncId(s)?n.resolveIds(s,next):next(null,s)};t.push(callback)}try{s=r.fn.apply(r.context,t);if("string"===typeof s&&n.hasAsyncId(s)){n.resolveIds(s,next);return}}catch(e){next(formatError(e,r,t));return}r.fn.async||next(null,s)}else e(null,r.fn)}};AsyncHelpers.prototype.resolveArgs=function*(e){for(var r=0;r<e.args.length;r++){var t=e.args[r];t&&("string"===typeof t&&this.hasAsyncId(t)?e.args[r]=yield this.resolveId(t):isObject(t)&&isObject(t.hash)&&(t.hash=yield this.resolveObject(t.hash)))}return e.args};AsyncHelpers.prototype.resolveObject=function*(e){var r=Object.keys(e);var t=this;return yield r.reduce((function(e,r){return s((function*(){var n=e[r];"string"===typeof n&&t.hasAsyncId(n)&&(e[r]=yield t.resolveId(n));return e}))}),e)};AsyncHelpers.prototype.resolveIds=function(e,r){if("function"!==typeof r)throw new TypeError("AsyncHelpers#resolveIds() expects a callback function.");if("string"!==typeof e)return r(new TypeError("AsyncHelpers#resolveIds() expects a string."));var t=this.matches(e);var n=this;s((function*(){if(!t)return e;for(var r=0;r<t.length;r++){var s=t[r];var i=yield n.resolveId(s);e=e.split(s).join(i)}return e})).then(e=>r(null,e)).catch(r)};function formatError(e,r,t){e.helper=r;define(e,"args",t);return e}function appendPrefix(e,r){return e+r+"$"}function createId(e,r){return appendPrefix(e,r)+"}"}function toRegex(e){var r=appendPrefix(e,"(\\d+)");if(i.hasOwnProperty(r))return i[r];var t=new RegExp(createRegexString(r),"g");i[r]=t;return t}function createRegexString(e){var r="createRegexString:"+e;if(i.hasOwnProperty(r))return i[r];var t=(e+"(\\d+)$}").replace(/\\?([${}])/g,"\\$1");i[r]=t;return t}function isHelperGroup(e){if(!e)return false;if(e.isGroup)return true;if("function"===typeof e||isObject(e)){var r=Object.keys(e).filter((function(e){return-1===["async","sync","displayName"].indexOf(e)}));return r.length>1}return false}function isObject(e){return"object"===n(e)}function define(e,r,t){Object.defineProperty(e,r,{configurable:true,enumerable:false,value:t})}t=AsyncHelpers;var o=t;export default o;

