// base-config-process@0.1.9 downloaded from https://ga.jspm.io/npm:base-config-process@0.1.9/index.js

import e from"debug";import r from"export-files";import i from"lazy-cache";import t from"base-config";import o from"base-config-schema";import n from"base-cwd";import a from"base-option";import s from"is-valid-app";import f from"micromatch";import c from"mixin-deep";var m={};m=r(new URL(import.meta.url.slice(0,import.meta.url.lastIndexOf("/"))).pathname);var p=m;var u={};var l=i(null);var g=null;require=l;t;o;n;a;s;f;c;require=g;l.toRegex=function(e){if(e instanceof RegExp)return e;if("string"===typeof e){var r={};-1!==e.indexOf("**")||/[\\\/]/.test(e)||(e="**/"+e);return l.mm.makeRe(e,r)}return/./};u=l;var d=u;var h={};var v=e("base:config:process");var b=p;var y=d;h=function(e){return function plugin(r,i){if(y.isValid(r,"base-config-process")){v("initializing <%s>, called from <%s>",new URL(import.meta.url).pathname,(void 0).id);var t=createOpts(r,e);var o;"undefined"===typeof this.cwd&&this.use(y.cwd(t));"undefined"===typeof this.option&&this.use(y.option(t));"undefined"===typeof this.config&&this.use(y.config(t));Object.defineProperty(this.config,"schema",{configurable:true,enumerable:true,set:function(e){o=e},get:function(){return o||y.schema(r,createOpts(r,e))}});for(var n in b){v('mapping field "%s"',n);r.config.map(n,b[n](r,i,t))}var a=this.config.process;this.config.process=function(i,t){v("normalizing config object",i);var o={sortArrays:false,omitEmpty:true,keys:["init","run","toc","layout","tasks","options","data","plugins","related","reflinks"]};var n=this.schema.normalize(i,createOpts(r,e,o));v("processing config object",n);a.call(this,n,(function(e){e?t(e):t(null,n)}))};return plugin}}};function createOpts(e,r,i){"undefined"!==typeof i&&(r=y.merge({},i,r));var t=y.merge({},r,e.options);return t.schema?y.merge({},t,t.schema):t}var x=h;export default x;

