// update@0.7.4 downloaded from https://ga.jspm.io/npm:update@0.7.4/index.js

import e from"fs";import t from"os";import r from"path";import o from"assemble-core";import n from"lazy-cache";import i from"assemble-loader";import a from"arr-union";import s from"base-cli-process";import l from"base-config-process";import p from"base-generators";import u from"base-questions";import f from"base-runtimes";import c from"base-store";import d from"data-store";import m from"common-config";import g from"extend-shallow";import h from"fs-exists-sync";import v from"isobject";import y from"is-valid-app";import b from"global-modules";import w from"log-utils";import U from"resolve-dir";import _ from"resolve-file";import x from"parser-front-matter";import O from"yargs-parser";import k from"find-pkg";import E from"process";var j={};var q=n(null);var A=null;require=q;i;a;s;l;p;u;f;c;d;m;g;h;v;y;b;w;U;_;x;O;require=A;q.stripPrefixes=function(e){e.stem=e.stem.replace(/^_/,".");e.stem=e.stem.replace(/^\$/,"")};q.opts={boolean:["diff"],alias:{add:"a",config:"c",configfile:"f",diff:"diffOnly",global:"g",help:"h",init:"i",silent:"S",verbose:"v",version:"V",remove:"r"}};q.parseArgs=function(e){var t=q.parse(e,q.opts);if(t.init){t._.push("init");delete t.init}if(t.help){t._.push("help");delete t.help}return t};q.remove=function(e,t){return e.filter((function(e){return-1===t.indexOf(e)}))};q.contains=function(e,t){return q.arrayify(e).some((function(e){return~t.indexOf(e)}))};q.isEmpty=function(e){return 0===q.arrayify(e).length};q.toArray=function(e){return"string"===typeof e?e.split(","):e};q.arrayify=function(e){return e?Array.isArray(e)?e:[e]:[]};q.logger=function(e){return function(){function logger(e,t){t=t||"dim";return function(r){var o=[].slice.call(arguments,1);return console.log.bind(console,q.log.timestamp+(e?" "+q.log[e]:"")).apply(console,[q.log[t](r)].concat(o))}}Object.defineProperty(this,"log",{configurable:true,get:function(){function log(){return console.log.apply(console,arguments)}log.path=function(e){return logger(null,"dim").apply(null,arguments)};log.time=function(e){return logger(null,"dim").apply(null,arguments)};log.warn=function(e){return logger("warning","yellow").apply(null,arguments)};log.success=function(){return logger("success","green").apply(null,arguments)};log.info=function(){return logger("info","cyan").apply(null,arguments)};log.error=function(){return logger("error","red").apply(null,arguments)};log.__proto__=q.log;return log}})}};j=q;var D=j;var R={};function _nullRequire(e){var t=new Error("Cannot find module '"+e+"'");t.code="MODULE_NOT_FOUND";throw t}var L=E;L.ORIGINAL_CWD=L.cwd();var P=t;var $=r;var I=k;var N=w;var S=D;var T=S.parseArgs(L.argv.slice(2));R=function(e,t,r){if("function"!==typeof r)throw new TypeError("expected a callback function");if(!t||"object"!==typeof t)throw new TypeError("expected config to be an object");var o=S.extend({},t,T);function logger(){o.silent||console.log.apply(console,arguments)}var n=I.sync(L.cwd());var i=n?$.dirname(n):L.cwd();if(i!==L.cwd()){logger(N.timestamp,"using cwd",N.yellow("~"+i));L.chdir(i)}var a=resolveBase();a instanceof e||(a=new e(o));a.set("cache.argv",o);var s=$.resolve(P.homedir(),"update/updatefile.js");var l=$.resolve(new URL(import.meta.url.slice(0,import.meta.url.lastIndexOf("/"))).pathname,"updatefile.js");var p=$.resolve(i,"updatefile.js");var u=_nullRequire(l);if(S.exists(p)){logger(N.timestamp,"using file",N.green("~"+p));var f=_nullRequire(p);if("function"===typeof f){function updater(){if(S.isValid(this,"default-updater")){this.use(u);this.use(f)}}a.register("default",updater)}else f&&f.isApp&&(a=f);a.updatefile=true}else{logger(N.timestamp,"using file",N.green("~"+l));a.register("default",u)}S.exists(s)&&a.register("home",_nullRequire(s));a||handleError(a,new Error("cannot run config file: "+p));"function"!==typeof a&&0===Object.keys(a).length&&handleError(a,new Error("expected a function or instance of Base to be exported"));a.option(T);a.on("error",(function(e){logger(e.stack)}));a.on("build",(function(e,t){if(t&&!t.isSilent){var r="finished"===e?N.success+" ":"";logger(N.timestamp,e,t.key,r+N.red(t.time))}}));a.on("task",(function(e,t){t&&!t.isSilent&&logger(N.timestamp,e,t.key,N.red(t.time))}));function resolveBase(){var e={path:$.resolve(i,"node_modules/update"),name:"update"};if(S.exists(e.path)){var t=_nullRequire(e.path);var r=new t(o);"undefined"===typeof r._name&&r.is("update");t.plugins(r);return r}}function handleError(e,t){if(e&&e.hasListeners&&e.hasListeners("error"))e.emit("error",t);else{console.error(t.stack);L.exit(1)}}r(null,a)};var B=R;var C={};function _nullRequire$1(e){var t=new Error("Cannot find module '"+e+"'");t.code="MODULE_NOT_FOUND";throw t}var F=e;var G=t;var M=r;var V=o;var z=D;var W=B;function Update(e){if(!(this instanceof Update))return new Update(e);V.call(this,e);this.is("update");this.initUpdate(this);this.initDefaults()}V.extend(Update);Update.prototype.initUpdate=function(){Update.emit("update.preInit",this);Update.plugins(this);Update.emit("update.postInit",this)};Update.prototype.initDefaults=function(){this.define("generators",this.generators);this.define("updater",this.generator);this.updaters=this.generators;var e=this;this.define("home",(function(){var t=[].slice.call(arguments);var r=M.resolve(e.options.homedir||G.homedir());return M.resolve.apply(M,[r].concat(t))}));this.option("help",{configname:"updater",appname:"update"});this.define("update",this.generate);this.define("getUpdater",(function(){return this.getGenerator.apply(this,arguments)}));this.option("toAlias",(function(e){return e.replace(/^updater?-(.*)$/,"$1")}));function isUpdater(e){return/^(updater|generate)?-/.test(e)}Object.defineProperty(this,"globals",{configurable:true,get:function(){return new z.Store("generate-globals",{cwd:z.resolveDir("~/")})}});Object.defineProperty(this,"common",{configurable:true,get:function(){return z.common}});this.onLoad(/(^|[\\\/])templates[\\\/]/,(function(t,r){var o=e.home("templates",t.basename);if(z.exists(o)){t.contents=F.readFileSync(o);t.homePath=o;t.isUserDefined=true}/^templates[\\\/]/.test(t.relative)&&(t.path=M.join(e.cwd,t.basename));z.stripPrefixes(t);z.parser.parse(t,r)}));this.option("lookup",(function(e){var t=[];isUpdater(e)||t.push(`updater-${e}`);return t}));this.on("unresolved",(function(e,t){if(isUpdater(e.name)){var r=z.resolve.file(e.name)||z.resolve.file(e.name,{cwd:z.gm});r&&(e.app=t.generator(e.name,_nullRequire$1(r.path)))}}));this.on("option",(function(t,r){if("dest"===t){e.base.cwd=r;e.cwd=r}}));this.on("ask",(function(t,r,o,n){t=t||o.default;"undefined"===typeof t&&(o.default=e.common.get(r))}));this.on("task:starting",(function(t,r){t&&t.app&&(t.app.cwd=e.base.options.dest||e.base.cwd||t.app.cwd);r&&r.app&&(r.app.cwd=e.base.options.dest||e.base.cwd||r.app.cwd)}))};Update.prototype.configfile=function(e){return z.configfile(e)};Update.prototype.getUpdaters=function(e,t){if(z.isObject(e)){t=e;e=[]}t=t||{};var r=this.option("updaters");this.addUpdaters(e,t);z.isEmpty(r)&&(r=this.pkg.get("update.updaters"));z.isEmpty(r)&&(r=this.globals.get("updaters"));t.remove&&(r=z.remove(r,z.toArray(t.remove)));t.add&&(r=z.union([],r,z.toArray(t.add)));return r};Update.prototype.addUpdaters=function(e,t){t=t||{};"string"===typeof e&&(e=z.toArray(e));t.config&&this.pkg.union("update.updaters",e);t.global&&this.globals.union("updaters",e)};Update.plugins=function(e){e.use(z.logger());e.use(z.generators());e.use(z.store("update"));e.use(z.runtimes());e.use(z.questions());e.use(z.loader());e.use(z.config());e.use(z.cli())};Update.resolveTasks=function(e,t){var r=z.arrayify(t._);if(r.length&&z.contains(["help","list","new","default"],r)){e.enable("silent");return r}if(r.length&&!z.contains(["help","list","new","default"],r))return r;r=e.getUpdaters(t.add,t);return r&&r.length?r:["init"]};Update.cli=W;C=Update;var H=C;export default H;

