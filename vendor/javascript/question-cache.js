// question-cache@0.5.1 downloaded from https://ga.jspm.io/npm:question-cache@0.5.1/index.js

import t from"use";import e from"util";import i from"debug";import s from"option-cache";import n from"lazy-cache";import r from"arr-flatten";import o from"arr-union";import a from"async-each-series";import u from"define-property";import p from"get-value";import f from"has-value";import h from"inquirer2";import c from"is-answer";import l from"isobject";import m from"mixin-deep";import y from"omit-empty";import d from"project-name";import v from"set-value";import g from"to-choices";import w from"process";var Q={};var j=n(null);var b=null;require=j;r;o;a;u;p;f;h;c;l;m;y;d;v;g;require=b;j.decorate=function(t){j.define(t,"set",function(t,e){j.set(this,t,e);return this}.bind(t));j.define(t,"get",function(t){return j.get(this,t)}.bind(t));j.define(t,"enabled",function(t){return true===this.get(t)}.bind(t));j.define(t,"disabled",function(t){return false===this.get(t)}.bind(t))};j.isEmpty=function(t){return!j.isAnswer(t)};j.matchesKey=function(t,e){if("string"!==typeof e||"string"!==typeof t)return false;if(t===e)return true;var i=t.length;var s=e.charAt(i);return 0===e.indexOf(t)&&"."===s};j.arrayify=function(t){return t?Array.isArray(t)?t:[t]:[]};j.isQuestion=function(t){return j.isObject(t)&&(t.isQuestion||!j.isOptions(t))};j.isOptions=function(t){return!!j.isObject(t)&&(!!t.hasOwnProperty("locale")||(!!t.hasOwnProperty("force")||!t.hasOwnProperty("type")&&(!t.hasOwnProperty("message")&&(!t.hasOwnProperty("choices")&&(!t.hasOwnProperty("name")&&void 0)))))};Q=j;var x=Q;var q={};var O=e;var A=i("questions:question");var k=x;function Question(t,e,i){if(k.isObject(t)){i=k.merge({},e,t);e=i.message;t=i.name}if(k.isObject(e)){i=k.merge({},i,e);e=i.message}k.define(this,"isQuestion",true);k.define(this,"cache",{});this.options=i||{};this.type=this.options.type||"input";this.message=e||this.options.message;this.name=t||this.options.name;this.message||(this.message=this.name);k.merge(this,this.options);createNext(this)}function createNext(t){if(t.options.next)if("function"!==typeof t.options.next){if("string"===typeof t.options.next){t.type="confirm";t.next=function(e,i,s,n){true===e?i.ask(t.options.next,n):n(null,s)}}}else t.next=function(){t.options.next.apply(t,arguments)}}Question.prototype.next=function(t,e,i,s){s(null,i)};Question.prototype.opts=function(t){var e=[].slice.call(arguments);t=[].concat.apply([],e);var i=k.omitEmpty(k.merge.apply(k.merge,[{}].concat(t)));k.decorate(i);"undefined"!==typeof i.default&&(this.default=i.default);if(false===i.persist){i.global=false;i.hint=false;i.save=false}false===i.save&&(i.force=true);return i};Question.prototype.setAnswer=function(t){this.answer=t;return this};Question.prototype.getAnswer=function(t,e,i){A('looking for answer for: "%s"',this.name);var s=k.get(e,this.name);A("answer:data %j",O.inspect(s));if("undefined"===typeof s){s=t[this.name];A("answer:answers %j",O.inspect(s))}if("undefined"===typeof s){s=k.get(t,this.name);A("answer:answers.get %j",O.inspect(s))}if("undefined"===typeof s&&i.store){s=i.store.get(this.name);A("answer:store.get %j",O.inspect(s))}if("undefined"===typeof s&&true===this.options.global&&i.globals){s=i.globals.get(this.name);A("answer:globals.get %j",O.inspect(s))}if("checkbox"===this.type||false===this.options.hints){A("returning answer: %j",s);this.setAnswer(s);return s}if("undefined"!==typeof s){this.default=s;A("default:answer %j",O.inspect(this.default))}if("undefined"===typeof this.default&&i.hints){this.default=i.hints.get(this.name);A("default:hint %j",O.inspect(this.default))}A("returning answer: %j",s);this.setAnswer(s);return s};Question.prototype.force=function(){this.options.force=true;return this};q=Question;var P=q;var z={};var C=w;var E=t;var K=e;var N=i("questions");var _=s;var S=P;var B=x;var D={};function Questions(t){if(!(this instanceof Questions))return new Questions(t);_.call(this,B.omitEmpty(t||{}));E(this);this.initQuestions(this.options)}K.inherits(Questions,_);Questions.prototype.initQuestions=function(t){N("initializing question-cache");this.answers=D;this.inquirer=t.inquirer||B.inquirer();this.project=t.project||B.project(C.cwd());this.Question=t.Question||S;this.data=t.data||{};this.cache={};this.queue=[]};Questions.prototype.set=function(t,e,i){this.addQuestion.apply(this,arguments);return this};Questions.prototype.addQuestion=function(t,e,i){if(B.isObject(t)&&!B.isQuestion(t))return this.visit("set",t);i=B.merge({},this.options,i);var s=new this.Question(t,e,i);N('questions#set "%s"',t);this.emit("set",s.name,s);this.cache[s.name]=s;B.union(this.queue,[s.name]);this.run(s);return s};Questions.prototype.choices=function(t,e,i,s){var n=B.toChoices();var r=n.apply(null,arguments);r.hasOwnProperty("save")||(r.save=false);this.set(r.name,r);return this};Questions.prototype.list=function(t,e,i,s){var n=B.toChoices({type:"list"});var r=n.apply(null,arguments);s&&(r.options=s);this.set(r.name,r);return this};Questions.prototype.rawlist=function(t,e,i,s){var n=B.toChoices({type:"rawlist"});var r=n.apply(null,arguments);s&&(r.options=s);this.set(r.name,r);return this};Questions.prototype.expand=function(t,e,i,s){var n=B.toChoices({type:"expand"});var r=n.apply(null,arguments);s&&(r.options=s);this.set(r.name,r);return this};Questions.prototype.confirm=function(){var t=this.addQuestion.apply(this,arguments);t.type="confirm";return this};Questions.prototype.get=function(t){return B.isQuestion(t)?t:this.cache[t]};Questions.prototype.has=function(t){for(var e in this.cache)if(0===e.indexOf(t))return true;return false};Questions.prototype.del=function(t){for(var e in this.cache)0===e.indexOf(t)&&delete this.cache[e]};Questions.prototype.clearAnswers=function(){this.answers=D={};this.data={}};Questions.prototype.clearQuestions=function(){this.cache={};this.queue=[]};Questions.prototype.clear=function(){this.clearQuestions();this.clearAnswers()};Questions.prototype.ask=function(t,e,i){if("function"===typeof t)return this.ask.call(this,this.queue,{},t);if("function"===typeof e)return this.ask.call(this,t,{},e);var s=this.buildQueue(t);var n=this.answers;var r=this;B.eachSeries(s,(function(t,i){N('asking question "%s"',t);try{var s=B.merge({},r.options,e);var o=B.merge({},r.data,s);var a=r.get(t);var u=a._options=a.opts(s);var p=a.getAnswer(n,o,r);r.emit("ask",p,t,a,n);p=a.getAnswer(n,o,r);N("using answer %j",p);u=a._options=a.opts(s,a.options);N("using options %j",u);if(u.enabled("skip")){N('skipping question "%s", using answer "%j"',t,p);r.emit("answer",p,t,a,n);a.next(p,r,n,i);return}var f=u.get("force");var h=true===f||B.matchesKey(f,t);if(!h&&B.isAnswer(p)){N('question "%s", using answer "%j"',t,p);B.set(n,t,p);r.emit("answer",p,t,a,n);a.next(p,r,n,i);return}r.inquirer.prompt([a],(function(e){N('answered "%s" with "%j"',t,e);try{var s=e[t];"checkbox"===a.type&&(s=B.flatten(s));if(!B.isAnswer(s)){i(null,n);return}B.set(n,t,s);r.emit("answer",s,t,a,n);a.next(s,r,n,i)}catch(t){r.emit("error",t);i(t)}}))}catch(t){r.emit("error",t);i(t)}}),(function(t){if(t)return i(t);r.emit("answers",n);i(null,n)}))};Questions.prototype.buildQueue=function(t){t=B.arrayify(t);var e=t.length;var i=[];var s=-1;0===e&&(i=this.queue);while(++s<e)B.union(i,this.normalize(t[s]));return i};Questions.prototype.normalize=function(t){N("normalizing %j",t);if(B.isQuestion(t))return[t.name];if(this.cache.hasOwnProperty(t))return[t];var e=0;var i=[];for(var s in this.cache)if(this.cache.hasOwnProperty(s)&&0===s.indexOf(t)){i.push(s);e++}return i};z=Questions;var F=z;export default F;

