// base-generators@0.4.6 downloaded from https://ga.jspm.io/npm:base-generators@0.4.6/index.js

import e from"path";import r from"debug";import t from"fs";import n from"lazy-cache";import i from"async-each-series";import a from"base-compose";import o from"base-cwd";import s from"base-data";import u from"base-env";import f from"base-option";import c from"base-pkg";import p from"base-plugins";import l from"base-task";import h from"define-property";import v from"extend-shallow";import g from"global-modules";import d from"is-valid-app";import m from"is-valid-instance";import y from"kind-of";import b from"mixin-deep";import k from"process";var G={};function _nullRequire(e){var r=new Error("Cannot find module '"+e+"'");r.code="MODULE_NOT_FOUND";throw r}var w=k;var A=t;var O=e;var _=n(null);var E=null;require=_;i;a;o;s;u;f;c;p;l;h;v;g;d;m;y;b;require=E;var x={};_.isValidTasks=function(e){return!!e&&(_.isString(e)?!/\W/.test(e):!!Array.isArray(e)&&e.every((function(e){return _.isString(e)&&!/\W/.test(e)})))};_.isGenerator=function(e){return _.isApp(e,"Generator")};_.isApp=function(e,r){return _.isObject(e)&&true===e["is"+r]};_.isString=function(e){return e&&"string"===typeof e};_.toArray=function(e){return Array.isArray(e)?e.reduce((function(e,r){return e.concat(_.toArray(r))}),[]):_.isString(e)?e.split(","):[]};_.arrayify=function(e){return e?Array.isArray(e)?e:[e]:[]};_.isObject=function(e){return"object"===_.typeOf(e)};_.tryRequire=function(e,r){r=r||w.cwd();try{return _nullRequire(e)}catch(e){}try{return _nullRequire(O.resolve(e))}catch(e){}try{return _nullRequire(O.resolve(r,"node_modules",e))}catch(e){}try{return _nullRequire(O.resolve(_.gm,e))}catch(e){}return null};_.exists=function(e){if(x.hasOwnProperty(e))return x[e];function set(e,r){e&&(x[e]=true);r&&(x[r]=true)}try{A.lstatSync(e);set(e);return true}catch(e){}try{var r=O.resolve("node_modules",e);if(x[r])return true;A.lstatSync(r);set(e,r);return true}catch(e){}try{r=O.resolve(_.gm,e);if(x[r])return true;A.lstatSync(r);set(e,r);return true}catch(e){}x[e]=false;return false};_.handleError=function(e,r,t){return function(n){if(n){var i=_.formatError(n,e,r);i?i instanceof Error?t(n):t(new Error(i)):t()}else t()}};_.formatError=function(e,r,t){if(e instanceof Error){var n=/task "(.*?)" is not registered/.exec(e.message);if(!n)return e;var i=n[1];if("default"===i)return;if(~t.indexOf(":")){var a=t.split(":");i=a[1];t=a[0]}}var o="Cannot find ";var s=r.getGenerator(t);if(s&&t!==i)o+='task: "'+i+("this"!==t?'" in generator':"");else{if("default"===t)return;o+="generator"}o+="this"!==t?': "'+t+'"':"";var u=r.get("options.cwd");u&&(o+=' in "'+u+'"');return o};G=_;var P=G;var j={};var q=P;function toGenerator(e,r,t,n){var i=n.constructor;var a=r;q.isValidInstance(r)?a.constructor=i:a=new i;var o=decorate(e,r,t,n);a.use(o);n.generators[a.alias]=a;n.generators[a.name]=a;n.generators[e]=a;n.emit("generator",a);return a}function decorate(e,r,t,n){return function(t){q.merge(this.options,n.options);this.is("generator");this.isApp=true;this.define("parent",n);n.run(this);this.on("error",n.emit.bind(n,"error"));Object.defineProperty(this,"env",{configurable:true,get:function(){return n.createEnv(e,r,this.options)}});Object.defineProperty(this,"alias",{configurable:true,get:function(){return this.env.alias}});Object.defineProperty(this,"name",{configurable:true,get:function(){return this.env.name}});this.define("isMatch",(function(){return this.env.isMatch.apply(this.env,arguments)}));this.define("invoke",(function(e,r){return this.env.invoke.apply(this.env,arguments)}))}}j=toGenerator;var S=j;var R={};var V=P;R=function(e,r,t){var n=r.env||{};var i=n.alias;var a=V.merge({},t||e.cache.config||e.pkg.get(e._name));r.set("cache.config",a);V.merge(r.options,e.options);V.merge(r.options,a);if(e.generators.hasOwnProperty("default")&&"default"!==i){var o=r.compose(["default"]).options();"function"===typeof e.data&&o.data();"function"===typeof e.pipeline&&o.pipeline();if("function"===typeof e.helper){o.helpers();o.engines();o.views()}"function"===typeof e.question&&o.questions()}};var D=R;var T={};var M=D;var W=P;T=function(e,r,t,n){var i=r.generator;var a=r.tasks;M(e,i);if(1!==a.length||i.tasks.hasOwnProperty(a[0])){W.merge(i.options,t);var o=i.env?i.env.alias:i._name;e.emit("generate",o,r.tasks,i);e._lookup&&(e.options.lookup=e._lookup);if("undefined"!==typeof i.config){var s=e.get("cache.config")||{};i.config.process(s,build)}else build()}else{if("default"===a[0]){n();return}var u="this"!==r.name?'" in generator: "'+r.name+'"':"";console.error('Cannot find task: "'+a[0]+u);n()}function build(e){if(e)return done(e);i.build(a,done)}function done(t,i){if(t){t.queue=r;W.handleError(e,r.name,n)(t)}else n(null,i)}};var C=T;var I={};var N=P;I=function(){return function fn(e){if(N.isValid(e,"base-generators-plugins")){this.define("isValid",N.isValid);this.use(N.plugins());this.use(N.cwd());this.use(N.pkg());this.use(N.env());this.use(N.option());this.use(N.data());this.use(N.compose());this.use(N.task())}return fn}};var U=I;var z={};z.parse=function(e,r,t){t&&!t.length&&(t=void 0);if(Array.isArray(r)){var n=r.reduce((function(r,t){return r.concat(z.parse(e,t))}),[]);return n.reduce((function(e,r){var t=e[e.length-1];if(t&&t.name===r.name){t.tasks=t.tasks.concat(r.tasks);return e}return e.concat(r)}),[])}if(!t&&/:/.test(r))return z.parse.apply(null,[e].concat(r.split(":")));"string"===typeof t&&(t=t.split(","));if(t)return[{name:r,tasks:t}];"string"===typeof r&&(r=r.split(","));return r.reduce((function(r,t){var n=z.process(e,t);var i=r[r.length-1];if(i&&i.name===n.name){i.tasks=i.tasks.concat(n.tasks);return r}return r.concat(n)}),[])};z.process=function(e,r){var t;if(e.tasks.hasOwnProperty(r))return{name:e.isDefault?"default":"this",tasks:[r]};if(/\./.test(r)||e.generators.hasOwnProperty(r))return{name:e.isDefault?"default."+r:r,tasks:["default"]};if(!e.isDefault){t=e.base.getGenerator("default");if(t)return z.process(t,r)}t=e.base.getGenerator(r);return t?{name:t.name,tasks:["default"],app:t}:{_:[r]}};var F={};var L=e;var B=r("base:generators");var H=S;var J=C;var K=U;var Q=z;var X=P;var Y=Q.parse;F=function(e){e=e||{};return function plugin(e){if(X.isValid(e,"base-generators")){this.isGenerator=true;this.generators={};var r={};this.define("constructor",this.constructor);this.use(K());this.fns.push(plugin);this.define({register:function(e,r,t){return this.setGenerator.apply(this,arguments)},generator:function(e,r,t){B(".generator",e,r);if(this.hasGenerator(e))return this.getGenerator(e);this.setGenerator.apply(this,arguments);return this.getGenerator(e)},setGenerator:function(e,r,t){B(".setGenerator",e);if(this.hasGenerator(e))return this.findGenerator(e);"string"===typeof r&&"."===r.charAt(0)&&this.env&&(r=L.resolve(this.env.dirname,r));return H(e,r,t,this)},getGenerator:function(e,r){B(".getGenerator",e);if("this"===e)return this;var t=this.findGenerator(e,r);return X.isValidInstance(t)?t.invoke(t,r):void 0},findGenerator:function fn(e,t){B(".findGenerator",e);if(X.isObject(e))return e;Array.isArray(e)&&(e=e.join("."));if("string"!==typeof e)throw new TypeError("expected name to be a string");if(r.hasOwnProperty(e))return r[e];var n=this.generators[e]||this.base.generators[e]||this._findGenerator(e,t);"undefined"===typeof n&&this.hasOwnProperty("parent")&&(n=this.base._findGenerator(e,t));if(n){r[n.name]=n;r[n.alias]=n;r[e]=n;return n}var i={name:e,options:t};this.base.emit("unresolved",i,this);if(i.app){r[i.app.name]=i.app;r[i.app.alias]=i.app;return i.app}r[e]=null},_findGenerator:function(e,r){if(this.generators.hasOwnProperty(e))return this.generators[e];if(~e.indexOf("."))return this.getSubGenerator.apply(this,arguments);var t=X.extend({},this.options,r);if("function"===typeof t.lookup){var n=this.lookupGenerator(e,t,t.lookup);if(n)return n}return this.matchGenerator(e)},getSubGenerator:function(e,r){B(".getSubGenerator",e);var t=e.split(".");var n=t.length;var i=-1;var a=this;while(++i<n){var o=t[i];a=a.getGenerator(o,r);if(!a)break}return a},matchGenerator:function(e){B(".matchGenerator",e);for(var r in this.generators){var t=this.generators[r];if(t.isMatch(e))return t}},hasGenerator:function(e,r){return this.generators.hasOwnProperty(e)||this.base.generators[e]},lookupGenerator:function(e,r,t){B(".lookupGenerator",e);if("function"===typeof r){t=r;r={}}if("function"!==typeof t)throw new TypeError("expected `fn` to be a lookup function");r=r||{};delete this.options.lookup;delete r.lookup;var n=t(e);B('looking up generator "%s" with "%j"',e,n);var i=n.length;var a=-1;while(++a<i){var o=this.findGenerator(n[a],r);if(o){this.options.lookup=t;return o}}this.options.lookup=t},extendWith:function(e,r){if("function"===typeof e){this.use(e,r);return this}if(Array.isArray(e)){var t=e.length;var n=-1;while(++n<t)this.extendWith(e[n],r);return this}var i=e;if("string"===typeof e){i=this.generators[e]||this.findGenerator(e,r);if(!i&&X.exists(e)){var a=X.tryRequire(e,this.cwd);"function"===typeof a&&(i=this.register(e,a))}}if(!X.isValidInstance(i))throw new Error('cannot find generator: "'+e+'"');var o=i.env?i.env.alias:"default";B('extending "%s" with "%s"',o,e);i.run(this);i.invoke(r,this);return this},generate:function(r,t,n,i){var a=this;if("function"===typeof r)return this.generate("default",[],{},r);if(X.isObject(r))return this.generate("default",["default"],r,t);if("function"===typeof t)return this.generate(r,[],{},t);if(X.isObject(t))return this.generate(r,[],t,n);if("function"===typeof n)return this.generate(r,t,{},n);var o=[];if(Array.isArray(r))return X.eachSeries(r,(function(e,r){a.generate(e,t,n,(function(e,t){if(e)return r(e);o=o.concat(t);r(null,t)}))}),(function(e){if(e)return i(e);i(null,o)}));if("function"!==typeof i)throw new TypeError("expected a callback function");var s=Y(e,r,t);X.eachSeries(s,function(t,a){if(t._&&t._.length){if("default"===t._[0]){a();return}var s=X.formatError("generator",e,t._);a(new Error(s))}else{if("finishRun"===i.name&&"string"===typeof r&&-1!==t.tasks.indexOf(r)){t.name=r;t.tasks=["default"]}t.generator=t.app||this.getGenerator(t.name,n);if(X.isGenerator(t.generator))J(this,t,n,(function(e,r){if(e)return a(e);o=o.concat(r);a(null,r)}));else{if("default"===t.name){a();return}a(new Error(X.formatError("generator",e,t.name)))}}}.bind(this),(function(e){if(e)return i(e);i(null,o)}))},toAlias:function(r,t){return"function"===typeof t?t(r):t&&"function"===typeof t.toAlias?t.toAlias(r):"function"===typeof e.options.toAlias?e.options.toAlias(r):r}});Object.defineProperty(this,"isDefault",{configurable:true,get:function(){return this.env&&this.env.isDefault}});return plugin}}};var Z=F;export default Z;

