// map-config@0.5.0 downloaded from https://ga.jspm.io/npm:map-config@0.5.0/index.js

import i from"array-unique";import t from"async";var n={};var e=i;var s=t;function MapConfig(i,t){if(!(this instanceof MapConfig))return new MapConfig(i,t);define(this,"isMapConfig",true);this.app=i||{};this.keys=[];this.aliases={};this.config={};this.async=false;if(t&&"object"===typeof t)for(var n in t)this.map(n,t[n])}MapConfig.prototype.map=function(i,t){if(isMapConfig(t))return this.subConfig.apply(this,arguments);if("string"===typeof t)return this.alias.apply(this,arguments);if("function"===typeof t){if(hasCallback(t)){this.async=true;t.async=true}}else t=this.app[i];this.config[i]=t;this.addKey(i);return this};MapConfig.prototype.subConfig=function(i,t){this.map(i,(function(i,n,e,s){t.process(i,s)}));return this.addKey(i,t.keys)};MapConfig.prototype.alias=function(i,t){if(this.config.hasOwnProperty(t))this.config[i]=this.config[t];else{this.aliases[i]=t;this.addKey(i)}return this};MapConfig.prototype.process=function(i,t){if("function"===typeof i){t=i;i=null}for(var n in this.aliases){var e=this.aliases[n];this.map(n,this.config[e]||this.app[e])}if("function"!==typeof t){if(true===this.async)throw new Error("expected a callback function");t=function(i){if(i)throw i}}i=i||{};s.eachOfSeries(i,function(t,n,e){var s=this.config[n];if("function"!==typeof s)return e();if(true===s.async)return s.call(this.app,t,n,i,e);try{s.call(this.app,t,n,i);return e()}catch(i){i.message="map-config#process "+i.message;return e(i)}}.bind(this),t.bind(this.app))};MapConfig.prototype.addKey=function(i,t){var n=this.keys.slice();if(Array.isArray(t)){n=n.concat(joinKeys(i,t));var s=n.indexOf(i);-1!==s&&n.splice(s,1)}else n.push(i);this.keys=e(n);return this};function isMapConfig(i){return i&&"object"===typeof i&&true===i.isMapConfig}function hasCallback(i){var t=/^function[ \t]*([\w\W]+?, *(cb|callback|next))/;return t.test(i.toString())}function joinKeys(i,t){var n=t.length;var e=-1;var s=[];while(++e<n)s.push(i+"."+t[e]);return s}function define(i,t,n){Object.defineProperty(i,t,{enumerable:false,configurable:true,value:n})}n=MapConfig;var a=n;export default a;

