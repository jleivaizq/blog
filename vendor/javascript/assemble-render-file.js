// assemble-render-file@0.7.2 downloaded from https://ga.jspm.io/npm:assemble-render-file@0.7.2/index.js

import e from"lazy-cache";import r from"is-valid-app";import n from"mixin-deep";import i from"through2";import l from"debug";var o={};var t=e(null);var a=null;require=t;r;n;i;require=a;t.debug=l("base:assemble:render-file");o=t;var s=o;var u={};var f=s;u=function(e){return function plugin(r){if(f.isValid(r,"assemble-render-file",["app","collection"])){var n=f.merge({},r.options,e);var i=f.debug;r.define("renderFile",(function(e,l){if("string"!==typeof e){l=e;e=null}i('renderFile: engine "%s"',e);l=l||{};var o={};if(l&&!l.isCollection)n=f.merge({},n,l);else{o=l;l={}}var t=n.View||n.File||o.View||this.View;var a=[];var s=[];return f.through.obj((function(o,u,f){if(o.isNull())f(null,o);else if(false!==o.data.render&&false!==n.render){o.isView||(o=new t(o));a.push(o);r.handleOnce("onLoad",o,(function(n,o){if(n)return f(n);s.push(o);i("renderFile, preRender: %s",o.relative);resolveEngine(r,l,e);l.engine||!r.isFalse("engineStrict")?r.render(o,l,(function(e,n){if("undefined"===typeof n||e)handleError(r,e,o,a,s,f);else{i("renderFile, postRender: %s",o.relative);f(null,n)}})):f(null,o)}))}else f(null,o)}))}));return plugin}}};function handleError(e,r,n,i,l,o){var t=i[i.length-1];r instanceof Error||(r=new Error("view cannot be rendered: "+t.path));r.files=i;r.handled=l;r.view=t;r.path=t.path;e.emit("error",r);o(r)}function resolveEngine(e,r,n){"string"!==typeof n?r.engine||e.engines[".noop"]&&(r.engine=".noop"):r.engine=n}var d=u;export default d;

