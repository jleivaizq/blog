// cloneable-readable@1.1.3 downloaded from https://ga.jspm.io/npm:cloneable-readable@1.1.3/index.js

import e from"readable-stream";import n from"inherits";import t from"process-nextick-args";var o={};var i=e.PassThrough;var s=n;var r=t;function Cloneable(e,n){if(!(this instanceof Cloneable))return new Cloneable(e,n);var t=e._readableState.objectMode;this._original=e;this._clonesCount=1;n=n||{};n.objectMode=t;i.call(this,n);forwardDestroy(e,this);this.on("newListener",onData);this.once("resume",onResume);this._hasListener=true}s(Cloneable,i);function onData(e,n){if("data"===e||"readable"===e){this._hasListener=false;this.removeListener("newListener",onData);this.removeListener("resume",onResume);r.nextTick(clonePiped,this)}}function onResume(){this._hasListener=false;this.removeListener("newListener",onData);r.nextTick(clonePiped,this)}Cloneable.prototype.clone=function(){if(!this._original)throw new Error("already started");this._clonesCount++;this.removeListener("newListener",onData);var e=new Clone(this);this._hasListener&&this.on("newListener",onData);return e};Cloneable.prototype._destroy=function(e,n){if(!e){this.push(null);this.end();this.emit("close")}r.nextTick(n,e)};function forwardDestroy(e,n){e.on("error",destroy);e.on("close",onClose);function destroy(t){e.removeListener("close",onClose);n.destroy(t)}function onClose(){n.end()}}function clonePiped(e){if(0===--e._clonesCount&&!e._readableState.destroyed){e._original.pipe(e);e._original=void 0}}function Clone(e,n){if(!(this instanceof Clone))return new Clone(e,n);var t=e._readableState.objectMode;n=n||{};n.objectMode=t;this.parent=e;i.call(this,n);forwardDestroy(e,this);e.pipe(this);this.on("newListener",onDataClone);this.on("resume",onResumeClone)}function onDataClone(e,n){if("data"===e||"readable"===e||"close"===e){r.nextTick(clonePiped,this.parent);this.removeListener("newListener",onDataClone)}}function onResumeClone(){this.removeListener("newListener",onDataClone);r.nextTick(clonePiped,this.parent)}s(Clone,i);Clone.prototype.clone=function(){return this.parent.clone()};Cloneable.isCloneable=function(e){return e instanceof Cloneable||e instanceof Clone};Clone.prototype._destroy=function(e,n){if(!e){this.push(null);this.end();this.emit("close")}r.nextTick(n,e)};o=Cloneable;var a=o;export default a;

