// base-data@0.6.2 downloaded from https://ga.jspm.io/npm:base-data@0.6.2/index.js

import e from"util";import t from"cache-base";import r from"fs";import a from"path";import i from"lazy-cache";import n from"arr-flatten";import s from"extend-shallow";import o from"get-value";import u from"has-glob";import f from"has-value";import c from"is-registered";import h from"is-valid-app";import l from"kind-of";import p from"merge-value";import m from"mixin-deep";import d from"read-file";import v from"resolve-glob";import y from"set-value";import g from"union-value";var b={};var x=r;var w=a;var O=i(null);var j=null;require=O;n;s;o;u;f;c;h;l;p;m;d;v;y;g;require=j;O.isValid=function(e,t){return O.isValidApp(e,"base-data:"+t,["app","collection","list","views","group"])};O.last=function(e){if(!Array.isArray(e))throw new TypeError("expected value to be an array");return e[e.length-1]};O.arrayify=function(e){return e?Array.isArray(e)?e:[e]:[]};O.matchLoaders=function(e,t){var r=e.length,a=-1;var i=w.extname(t);var n=[];if(0===r&&".json"===i)return[function(e){return JSON.parse(e)}];while(++a<r){var s=e[a];var o=s.name;("string"===typeof o&&i===O.formatExt(o)||"regexp"===O.typeOf(o)&&o.test(i))&&n.push(s.fn)}return n.length?n:null};O.formatExt=function(e){return"."!==e.charAt(0)?"."+e:e};O.namespace=function(e,t,r){var a=O.rename(e,t,r);if(true===r.namespace&&"data"===a)return t;var i={};O.set(i,a,t);return i};O.rename=function(e,t,r){var a=O.basename;if("string"===typeof r.namespace)return r.namespace;"function"===typeof r.namespace&&(a=r.namespace);return a(e,t,r)};O.basename=function(e){return w.basename(e,w.extname(e))};O.isGlob=function(e,t){return!("undefined"!==typeof t&&!O.isObject(t))&&O.hasGlob(e)};O.hasAny=function(e,t){var r=t.length;while(r--)if(e.hasOwnProperty(t[r]))return true;return false};O.isObject=function(e){return!(!e||Array.isArray(e))&&"object"===typeof e};var A=["namespace","renameKey"];var D=["base","cwd","destBase","expand","ext","extDot","extend","flatten","rename","process","srcBase"];O.isOptions=function(e){if(!O.isObject(e))return false;var t=D.concat(A);return O.hasAny(e,t)};b=O;var L=b;var E={};var V=e;var F=t;var _=F.namespace("cache");var G=L;E=function(e,t){if(G.isObject(e)){t=e;e="cache.data"}"undefined"===typeof e&&(e="cache.data");return function baseData(){if(G.isValid(this,e)){this.dataLoaders||this.define("dataLoaders",[]);var r=this.get(e);if("undefined"===typeof r){this.set(e,{});r=this.get(e)}var a=new Data(r);r=a.cache;this.define("dataLoader",(function(e,t){this.dataLoaders.push({name:e,fn:t});return this}));this.define("data",(function(e,r,i){if("undefined"===typeof e)return this;var n=[].slice.call(arguments);var s=G.last(n);var o=this;this.emit("data",n);if(G.isObject(e)){a.merge.apply(a,arguments);return this}if(G.isGlob(e,r)){var u=G.merge({},t,this.options);G.isObject(s)&&(u=G.merge({},u,n.pop()));n.push(u);var f=G.resolve.sync.apply(null,n);var c=f.length,h=-1;while(++h<c)readFile(this,f[h],u);return this}if(Array.isArray(e)&&1===arguments.length){e.forEach((function(e){o.data(e)}));return this}if("string"===typeof e){u=G.extend({},t,this.options);G.isOptions(s)&&(u=G.extend({},u,n.pop()));if(1===n.length){var l=readFile(this,e,u);if(null===l){if(/[\\\/]/.test(e))throw new Error("Failed to read: "+e);return a.get(e)}return this}if(G.isObject(r)){a.merge(e,r);return this}if(i){a.union.apply(a,arguments);return this}a.set(e,r);return this}return this}));this.data.__proto__=a;return baseData}function readFile(e,t,r){var a=G.matchLoaders(e.dataLoaders,t);if(!a)return null;var i=G.extend({},e.options,r);var n=G.read.sync(t);if(null===n)return null;var s=a.length,o=-1;while(++o<s){var u=a[o];n=u.call(e,n,t)}i.namespace?e.data(G.namespace(t,n,i)):e.data(n);return n}}};E.utils=G;function Data(e,t){_.call(this);this.options=t||{};this.cache=e||{}}V.inherits(Data,_);Data.prototype.extend=function(e,t){if("string"===typeof e&&G.isObject(t)){var r=this.get(e);this.set(e,G.extend({},r,t));return this}var a=G.flatten([].slice.call(arguments));var i=a.length;var n=-1;while(++n<i)G.extend(this.cache,a[n]);return this};Data.prototype.merge=function(e,t){if("string"===typeof e&&G.isObject(t)){G.mergeValue(this.cache,e,t);return this}var r=G.flatten([].slice.call(arguments));var a=r.length;var i=-1;while(++i<a)this.cache=G.merge(this.cache,r[i]);return this};Data.prototype.union=function(e,t){G.unionValue(this.cache,e,t);return this};Data.prototype.set=function(e,t){if(G.isObject(e))return this.merge.apply(this,arguments);G.set(this.cache,e,t);return this};Data.prototype.get=function(e){return G.get(this.cache,e)};var q=E;const B=E.utils;export default q;export{B as utils};

