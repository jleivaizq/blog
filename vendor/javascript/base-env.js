// base-env@0.3.1 downloaded from https://ga.jspm.io/npm:base-env@0.3.1/index.js

import t from"debug";import e from"path";import i from"base-namespace";import n from"contains-path";import r from"extend-shallow";import a from"fs-exists-sync";import s from"global-modules";import o from"is-absolute";import p from"is-valid-app";import h from"is-valid-instance";import f from"kind-of";import u from"os-homedir";import l from"resolve-file";import c from"process";import g from"util";import m from"fs";var d={};function _nullRequire(t){var e=new Error("Cannot find module '"+t+"'");e.code="MODULE_NOT_FOUND";throw e}_nullRequire.resolve=_nullRequire;var v=c;var y=e;var b=t("base:env");var _=d={};var w={};_.namespace=i;_.containsPath=n;_.extend=r;_.exists=a;_.gm=s;_.isAbsolute=o;_.isValidApp=p;_.isValidInstance=h;_.typeOf=f;_.home=u;_.resolve=l;_.isObject=function(t){return"object"===_.typeOf(t)};_.isString=function(t){return t&&"string"===typeof t};_.identity=function(t){return t};_.isValid=function(t){if(!_.isValidApp(t,"base-env"))return false;b("initializing <%s>, called from <%s>",new URL(import.meta.url).pathname,(void 0).id);return true};_.isValidArg=function(t){return _.isAppArg(t)||_.isObject(t)};_.isAppArg=function(t){return _.isValidInstance(t)||"function"===typeof t||"string"===typeof t};_.tryResolve=function(t){if(w[t])return w[t];try{var e=y.resolve(v.cwd(),"node_modules",t);var i=_nullRequire(e);w[t]=i;return i}catch(t){}};_.instanceName=function(t){var e=t.app&&(t.app.namespace||t.app._namespace||t.app._name);return"instance"+(e?" "+e:"")};_.functionName=function(t){return"function"+(t.fn.name?" "+t.fn.name:"")};_.pathName=function(t){var e=t.key;_.exists(e)&&!_.containsPath(v.cwd(),t.path)&&(e=y.relative(_.home(),y.resolve(t.path)));return"path ~/"+e};var k=d;var x={};function _nullRequire$1(t){var e=new Error("Cannot find module '"+t+"'");e.code="MODULE_NOT_FOUND";throw e}var P=m;var E=e;var O=k;x=function(t,e){var i=O.extend({},e);if(O.isAbsolute(t.path))t=O.resolve.file(t,(function(t){return resolvePath(t,e)}));else if("string"===typeof i.cwd)t=O.resolve.file(t,i);else if(O.exists(t.path))t=O.resolve.file(t,i);else if(O.tryResolve(t.path)){t.path=O.tryResolve(t.path);t=O.resolve.file(t)}else if(!O.isAbsolute(t.path)){i.cwd=O.gm;t=O.resolve.file(t,i)}return t};function resolvePath(t,e){var i=O.extend({},e,t.options);t.isDirectory=function(){t.stat||(t.stat=P.lstatSync(t.path));return t.stat.isDirectory()};Object.defineProperty(t,"pkgPath",{configurable:true,set:function(t){this._pkgPath=t},get:function(){if(O.isString(this._pkgPath))return this._pkgPath;var t=this.isDirectory()?this.path:this.dirname;var e=this.app||{};if(O.isObject(e.pkg)&&"function"===typeof e.pkg.get&&e.pkg.options.cwd===t)return e.pkg.path;var i=E.resolve(t,"package.json");return O.exists(i)?i:null}});Object.defineProperty(t,"pkg",{configurable:true,set:function(t){this._pkg=t},get:function(){return O.isObject(this._pkg)&&O.isString(this._pkg.name)?this._pkg:this.pkgPath?this._pkg=_nullRequire$1(this.pkgPath):{}}});if(t.isDirectory()){var n=E.resolve(t.path,"index.js");var r=t.basename;t.pkg&&!O.exists(n)&&(n=E.resolve(t.path,t.pkg.main));if(O.exists(n)){t.folderName=r;O.isAbsolute(t.name)&&(t.name=r);"function"===typeof t.options.toAlias&&(t.alias=t.options.toAlias.call(t,t.name,t));t.path=n;t.basename=E.basename(t.path);t.dirname=E.dirname(t.path)}}if("function"===typeof i.resolve){var a=i.resolve(t);O.isString(a)?t.path=a:a&&(t=a)}return t}var j=x;var F={};function _nullRequire$2(t){var e=new Error("Cannot find module '"+t+"'");e.code="MODULE_NOT_FOUND";throw e}var A=c;var D=m;var N=e;var V=k;function File(t,e){t=t||{};this.file=t;this.options=t.options||e||{};this.type=this.file.type;this.origPath=t.origPath;var i=t.path?[t.path]:t.history;this.history=i||[];this.cwd=t.cwd||A.cwd();this.base=t.base||this.cwd;this.stat=t.stat||null;this._isFile=true}File.prototype.inspect=function(){var t=[];var e=this.base&&this.path?this.relative:this.path;e&&t.push('"'+e+'"');return"<File "+t.join(" ")+">"};File.prototype.isFile=function(){return this.stat&&this.stat.isFile()};File.prototype.isDirectory=function(){return this.stat&&this.stat.isDirectory()};File.prototype.prev=function(t){return this.history[this.history.length-(t||1)]};Object.defineProperty(File.prototype,"stat",{configurable:true,set:function(t){this._stat=t},get:function(){if("undefined"!==typeof this._stat&&(this.path===this.prev(2)||1===this.history.length))return this._stat;if(!this.path)throw new Error("expected file.path to be a string, cannot get file.stat");if(V.exists(this.path)){this._stat=D.lstatSync(this.path);return this._stat}return this._stat=null}});Object.defineProperty(File.prototype,"relative",{configurable:true,set:function(){throw new Error("file.relative is generated from file.base and file.path and cannot be modified")},get:function(){if(!this.base)throw new Error("expected file.base to be a string, cannot get file.relative");if(!this.path)throw new Error("expected file.path to be a string, cannot get file.relative");return N.relative(this.base,this.path)}});Object.defineProperty(File.prototype,"dirname",{configurable:true,set:function(t){if(!this.path)throw new Error("expected file.path to be a string, cannot set file.dirname");this.path=N.join(t,N.basename(this.path))},get:function(){if(!this.path)throw new Error("expected file.path to be a string, cannot get file.dirname");return N.dirname(this.path)}});Object.defineProperty(File.prototype,"basename",{configurable:true,set:function(t){if(!this.path)throw new Error("expected file.path to be a string, cannot set file.basename");this.path=N.join(N.dirname(this.path),t)},get:function(){if(!this.path)throw new Error("expected file.path to be a string, cannot get file.basename");return N.basename(this.path)}});Object.defineProperty(File.prototype,"stem",{configurable:true,set:function(t){if(!this.path)throw new Error("expected file.path to be a string, cannot set file.stem");this.path=N.join(N.dirname(this.path),t+this.extname)},get:function(){if(!this.path)throw new Error("expected file.path to be a string, cannot get file.stem");return N.basename(this.path,this.extname)}});Object.defineProperty(File.prototype,"extname",{configurable:true,set:function(t){if(!this.path)throw new Error("expected file.path to be a string, cannot set file.extname");this.path=N.join(this.dirname,this.stem+t)},get:function(){if(!this.path)throw new Error("expected file.path to be a string, cannot get file.extname");return N.extname(this.path)}});Object.defineProperty(File.prototype,"path",{configurable:true,set:function(t){if("string"!==typeof t)throw new Error("expected file.path to be a string");t&&t!==this.path&&this.history.push(t)},get:function(){return this.history[this.history.length-1]}});Object.defineProperty(File.prototype,"name",{configurable:true,set:function(t){this._name=t},get:function(){if(true===this.isDefault)return"default";if(this._name)return this._name;if("function"===typeof this.options.renameKey){this._name=this.options.renameKey.call(this,this._name);return this._name}if(this.origPath&&this.key!==this.origPath)return this._name=this.key;if(V.isString(this.pkg.name)&&V.exists(N.resolve(this.cwd,this.key))){this._name=this.pkg.name;return this._name}if(!this.path)throw new Error("expected file.path to be a string, cannot get file.stat");return this._name||(this._name=this.key)}});Object.defineProperty(File.prototype,"alias",{configurable:true,set:function(t){this._alias=t},get:function(){if(V.isString(this._alias))return this._alias;if(!this.name)throw new Error("expected file.name to be a string, cannot get file.alias");var t=this.app||{};var e=V.extend({},this.options,t.options);return"function"===typeof e.toAlias?this._alias=e.toAlias.call(this,this.name,this):this._alias=this.key}});Object.defineProperty(File.prototype,"fn",{configurable:true,set:function(t){this._fn=t},get:function(){if("function"===typeof this._fn)return this._fn;if(!this.path)throw new Error("expected file.path to be a string, cannot get file.fn");if("app"===this.type)return this.app;var t=_nullRequire$2(this.path);if("function"===typeof t){this._fn=t;return t}if(V.isValidInstance(t)){this._fn=function(){return t};return this._fn}throw new Error("expected file.path to export a function or instance")}});Object.defineProperty(File.prototype,"key",{configurable:true,set:function(t){this._key=t},get:function(){return this._key||this.file.key}});Object.defineProperty(File.prototype,"app",{configurable:true,set:function(t){this._app=t},get:function(){var t=this._app||this.file.app;return V.isValidInstance(t)?this._app=t:null}});Object.defineProperty(File.prototype,"pkgPath",{configurable:true,set:function(t){this._pkgPath=t},get:function(){if(V.isString(this._pkgPath))return this._pkgPath;var t=this.isFile()?this.dirname:this.path;var e=this.app||{};if(V.isObject(e.pkg)&&"function"===typeof e.pkg.get&&e.pkg.options.cwd===t)return e.pkg.path;var i=N.resolve(t,"package.json");return V.exists(i)?i:null}});Object.defineProperty(File.prototype,"pkg",{configurable:true,set:function(t){this._pkg=t},get:function(){return V.isObject(this._pkg)&&V.isString(this._pkg.name)?this._pkg:this.pkgPath?this._pkg=_nullRequire$2(this.pkgPath):{}}});File.isFile=function(t){return"object"===V.typeOf(t)&&true===t._isFile};F=File;var R=F;var S={};var q=g;var I=t("base:base-env");var U=j;var $=k;var T=R;function Env(t,e,i,n){var r=normalize({name:t,app:i,key:t,options:n||{}},e);T.call(this,r);$.extend(this,r);this.isEnv=true}q.inherits(Env,T);Env.prototype.isMatch=function(t){return this.key===t||this.alias===t||this.name===t||"path"===this.type&&(!(!this.origPath||this.origPath!==t)||(this.stem===t||this.basename===t||this.path===t||this.dirname===t||this.folderName===t))};Env.prototype.invoke=function(t,e){I('invoking "%s"',this.namespace);e=e||{};if($.isValidInstance(t)){"undefined"===typeof t.parent&&(t.parent=this.app);this.app=t}else if($.isValidInstance(e)){t=e;e={}}else{e=t;t=this.app}if("function"===typeof this.fn){var i=this.fn.call(t,t,t.base,this,e);if($.isValidInstance(i)){this.app=i;return i}}"app"===this.type&&$.extend(t.options,e);return t};Env.prototype.inspect=function(){var t="";switch(this.type){case"app":t=$.instanceName(this);break;case"path":t=$.pathName(this);break;case"function":default:t=$.functionName(this);break}return`<Env "${this.name}" [${t}]>`};Object.defineProperty(Env.prototype,"isDefault",{configurable:true,get:function(){return"default"===this.key}});Object.defineProperty(Env.prototype,"namespace",{configurable:true,get:function(){return this.app.namespace?this.app.namespace+"."+this.alias:this.alias}});function normalize(t,e){var i=$.extend({},t);if("string"===typeof e){t.type="path";t.path=e;t.origPath=e;t=U(t,t.options)}else if("function"===typeof e){t.type="function";t.path=t.name;t.fn=e}else{if(!$.isAppArg(t.app))throw new TypeError("expected env to be a string or function");t.type="app";t.path=t.name;t.app=e}if(null===t){var n="string"===typeof e?e:i.key;throw new Error("cannot resolve: "+q.inspect(n))}return t}S=Env;var L=S;var M={};var z=t("base:base-env");var C=k;var K=L;M=function(t){t=t||{};return function envPlugin(t){if(C.isValid(t)){t.use(C.namespace());t.define("createEnv",(function(t,e,i){z('createEnv: "%s"',t);if(!C.isString(t))throw new TypeError("expected name to be a string");if("default"===t)return new K(t,e,this,i);C.isValidArg(e)||(e={});return C.isAppArg(i)?this.createEnv(t,i,e):C.isAppArg(e)?C.isValidInstance(i)?new K(t,e,i,{}):new K(t,e,this,i):this.createEnv(t,t,C.extend(e,i))}));return envPlugin}}};var B=M;export default B;

